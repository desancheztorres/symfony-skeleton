# Docker Compose configuration for TESTING environment
# Optimized for CI/CD pipelines with fast startup and testing isolation
version: "3.9"

services:
  php:
    build:
      context: .
      dockerfile: Dockerfile
      target: testing
      args:
        PUID: ${PUID:-1000}
        PGID: ${PGID:-1000}
    container_name: symfony-php-test
    environment:
      APP_ENV: test
      DATABASE_URL: mysql://test:test@db:3306/app_test?serverVersion=mariadb-11.4&charset=utf8mb4
    depends_on:
      - db

  db:
    image: mariadb:11.4
    container_name: symfony-mariadb-test
    environment:
      MARIADB_ROOT_PASSWORD: test
      MARIADB_DATABASE: app_test
      MARIADB_USER: test
      MARIADB_PASSWORD: test
    tmpfs:
      # In-memory database for faster testing
      - /var/lib/mysql:rw,size=1G

volumes: {}